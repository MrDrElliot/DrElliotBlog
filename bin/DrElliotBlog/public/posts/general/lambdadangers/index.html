<!DOCTYPE html>
<html lang="en-us" dir="ltr">
<head>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>The dangers of Lambdas | Dr. Elliot</title>
<link rel="icon" href="/favicon.svg" sizes="any" type="image/svg+xml" /><meta property="og:url" content="https://www.dr-elliot.com/posts/general/lambdadangers/">
  <meta property="og:site_name" content="Dr. Elliot">
  <meta property="og:title" content="The dangers of Lambdas">
  <meta property="og:description" content="Using Lambdas in Unreal can be dangerous! Lambdas, or anonymous functions, in Unreal Engine can be very useful for writing concise and flexible code. However, they come with certain dangers, particularly when dealing with the lifetime of objects and capturing variables by reference. Here’s why:
1. Capturing by Reference and Object Lifetimes When you use lambdas in Unreal Engine, you might capture variables by reference, which is common for avoiding unnecessary copying.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-08-16T13:46:48-05:00">
    <meta property="article:modified_time" content="2024-08-16T13:46:48-05:00">
    <meta property="article:tag" content="Programming">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="The dangers of Lambdas">
  <meta name="twitter:description" content="Using Lambdas in Unreal can be dangerous! Lambdas, or anonymous functions, in Unreal Engine can be very useful for writing concise and flexible code. However, they come with certain dangers, particularly when dealing with the lifetime of objects and capturing variables by reference. Here’s why:
1. Capturing by Reference and Object Lifetimes When you use lambdas in Unreal Engine, you might capture variables by reference, which is common for avoiding unnecessary copying.">

      <link rel="stylesheet" href="/css/root.min.0e732b812b9751962e01a7c4798a1211cd5f8ac8abec7f99793fe306989e459f.css" integrity="sha256-DnMrgSuXUZYuAafEeYoSEc1fisir7H&#43;ZeT/jBpieRZ8=" crossorigin="anonymous">
      <link rel="stylesheet" href="/css/bundle.min.59eb1a059f8cd558e64375ede3e68d3e9120ddb0c6bdbab555c247689cef59e1.css" integrity="sha256-WesaBZ&#43;M1VjmQ3Xt4&#43;aNPpEg3bDGvbq1VcJHaJzvWeE=" crossorigin="anonymous">

      <script src="/js/bundle.cc8ae9952dbfb731affafabdf26e5c60a6910047ff59ccdeaf1daebaa26c8830.js" integrity="sha256-zIrplS2/tzGv&#43;vq98m5cYKaRAEf/Wczerx2uuqJsiDA=" crossorigin="anonymous"></script><script defer src="/js/search/flexsearch.compact.5e0de3b335e5c523c7cf45473dc43fccb6c75f64a9d59cc04a6eccbb7c25eb49.js" integrity="sha256-Xg3jszXlxSPHz0VHPcQ/zLbHX2Sp1ZzASm7Mu3wl60k="></script>
<script defer src="/js/search/search.1d980f84df11f3eb7c8c5f17f541d49a0611608df179dd74fa7f06225eb56ace.js" integrity="sha256-HZgPhN8R8&#43;t8jF8X9UHUmgYRYI3xed10&#43;n8GIl61as4="></script>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Spectral:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800;1,200;1,300;1,400;1,500;1,600;1,700;1,800&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,200..800&family=Spectral:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800;1,200;1,300;1,400;1,500;1,600;1,700;1,800&display=swap" rel="stylesheet">

</head>
<body class="notransition">
  <div id="container">
    <header id="main-header"><div role="navigation" aria-label="Main">
  <div class="nav-left">
    <a href="https://www.dr-elliot.com/" style="color: inherit;">Dr. Elliot</a>
  </div>
  <div class="nav-right">
    <div style="position:absolute;width:0px;height:0px;">
      <div id="nav-dropdown-menu" class="hidden" href="#">
    <div class="nav-item">
      <a aria-current="true" class="ancestor" href="/posts/"
      >Posts</a>
    </div>
    <div class="nav-item">
      <a href="/lumina/lumina/"
      >Lumina</a>
    </div>
    <div class="nav-item">
      <a href="/about/aboutme/"
      >About</a>
    </div>
</div>
    </div>
    <a id="nav-dropdown-button" href="#"><svg width="20px" height="20px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M4 6H20M4 12H20M4 18H20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
</a>
    <div id="nav-menu">
    <div class="nav-item">
      <a aria-current="true" class="ancestor" href="/posts/"
      >Posts</a>
    </div>
    <div class="nav-item">
      <a href="/lumina/lumina/"
      >Lumina</a>
    </div>
    <div class="nav-item">
      <a href="/about/aboutme/"
      >About</a>
    </div>
</div>
    <a id="theme-switcher" href="#">
<svg class="light-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M12 3V4M12 20V21M4 12H3M6.31412 6.31412L5.5 5.5M17.6859 6.31412L18.5 5.5M6.31412 17.69L5.5 18.5001M17.6859 17.69L18.5 18.5001M21 12H20M16 12C16 14.2091 14.2091 16 12 16C9.79086 16 8 14.2091 8 12C8 9.79086 9.79086 8 12 8C14.2091 8 16 9.79086 16 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
</svg>

<svg class="dark-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M3.32031 11.6835C3.32031 16.6541 7.34975 20.6835 12.3203 20.6835C16.1075 20.6835 19.3483 18.3443 20.6768 15.032C19.6402 15.4486 18.5059 15.6834 17.3203 15.6834C12.3497 15.6834 8.32031 11.654 8.32031 6.68342C8.32031 5.50338 8.55165 4.36259 8.96453 3.32996C5.65605 4.66028 3.32031 7.89912 3.32031 11.6835Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
</a>
  </div>
</div>
</header>
    <div class="flex grow">
      <div id="main-pane">
        <main id="main-content"><div class="single-header">
<ol class="breadcrumbs" itemscope itemtype="https://schema.org/BreadcrumbList">
    <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
      <a itemprop="item" href="https://www.dr-elliot.com/">
        <span itemprop="name">Home</span>
      </a>
      <meta itemprop="position" content='1' />
    </li>
    <span>&nbsp»&nbsp</span>
    <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
      <a itemprop="item" href="https://www.dr-elliot.com/posts/">
        <span itemprop="name">Posts</span>
      </a>
      <meta itemprop="position" content='2' />
    </li>
    <span>&nbsp»&nbsp</span>
</ol>
<h1>The dangers of Lambdas</h1><time class="dim" datetime="2024-08-16T13:46:48-05:00">August 16, 2024</time><div class="term-container"><div class="tag">
        <a href="https://www.dr-elliot.com/tags/programming/">#Programming</a>
      </div></ol></div>

  <section class="page-section"><h1 id="using-lambdas-in-unreal-can-be-dangerous">Using Lambdas in Unreal can be dangerous!</h1>
<hr>
<p>Lambdas, or anonymous functions, in Unreal Engine can be very useful for writing concise and flexible code. However, they come with certain dangers, particularly when dealing with the lifetime of objects and capturing variables by reference. Here’s why:</p>
<h3 id="1-capturing-by-reference-and-object-lifetimes">1. <strong>Capturing by Reference and Object Lifetimes</strong></h3>
<p>When you use lambdas in Unreal Engine, you might capture variables by reference, which is common for avoiding unnecessary copying. However, if the lambda is executed asynchronously (e.g., in a timer, or a delegate callback), the objects referenced might be destroyed or go out of scope by the time the lambda is executed. This leads to dereferencing invalid memory, causing crashes with errors like:</p>
<pre tabindex="0"><code>Unhandled Exception: EXCEPTION_ACCESS_VIOLATION reading address 0x0000000000000000
</code></pre><p>This particular error occurs because the lambda is trying to access an object or memory location that no longer exists, often leading to a null pointer dereference.</p>
<h3 id="2-deferred-execution">2. <strong>Deferred Execution</strong></h3>
<p>In Unreal, many systems use deferred execution, where code is scheduled to run later (e.g., after a delay, or on the next frame). Lambdas are often used in these scenarios for their flexibility. However, if the lambda captures pointers or references to Unreal objects that may be garbage collected or destroyed before the lambda runs, the lambda will end up accessing invalid memory. This is especially problematic in cases where the object’s destruction isn’t under your control, such as when the object is managed by Unreal’s garbage collector.</p>
<h3 id="3-complex-debugging">3. <strong>Complex Debugging</strong></h3>
<p>Lambdas can obscure the flow of your code, making debugging more complex. When a crash happens inside a lambda, the stack trace might not clearly indicate where or why it occurred. This is because the lambda could be executed in a completely different context from where it was defined, making it difficult to track down the source of the problem.</p>
<h3 id="4-capturing-this">4. <strong>Capturing <code>this</code></strong></h3>
<p>Another common pitfall is capturing <code>this</code> inside a lambda. If the lambda is executed after the object has been destroyed, it will try to access a member function or variable of an object that no longer exists, leading to undefined behavior. This is particularly dangerous in Unreal, where object lifetimes are managed in complex ways, especially with asynchronous tasks.</p>
<h3 id="how-to-mitigate-these-issues"><strong>How to Mitigate These Issues</strong></h3>
<ol>
<li>
<p><strong>Prefer Capturing by Value:</strong> If possible, capture variables by value rather than by reference. This way, the lambda will have its own copy of the data, independent of the original object&rsquo;s lifetime.</p>
</li>
<li>
<p><strong>Use <code>TWeakObjectPtr</code>:</strong> When capturing pointers to Unreal objects, consider using <code>TWeakObjectPtr</code> instead of raw pointers. <code>TWeakObjectPtr</code> will safely handle cases where the object is destroyed, allowing you to check if the object is still valid before accessing it.</p>
</li>
<li>
<p><strong>Check for Validity:</strong> Before accessing any captured pointers or references, explicitly check their validity within the lambda. This includes checking if pointers are <code>nullptr</code> or if <code>TWeakObjectPtr</code> is still valid.</p>
</li>
<li>
<p><strong>Keep Lambdas Small and Focused:</strong> Try to keep lambdas small and focused on a single task. This makes it easier to track down issues and reduces the likelihood of capturing unnecessary variables.</p>
</li>
<li>
<p><strong>Using a <code>Weak Lambda</code>.</strong> Some may consider this a hack, but a <em>weak lambda</em> allows you to safely reference an object inside of a lambda, and avoid calling the lambda through the delegate if the owning object is invalid.
&ndash; Here is a quick example of a weak lambda in use. Taken from <code>TestBTTask_TimerBasedLatent.cpp</code></p>
</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">const</span> UWorld<span style="color:#f92672">*</span> World <span style="color:#f92672">=</span> OwnerComp.GetWorld())
</span></span><span style="display:flex;"><span>	{
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">float</span> DeltaTime <span style="color:#f92672">=</span> NumTicksExecuting <span style="color:#f92672">*</span> FAITestHelpers<span style="color:#f92672">::</span>TickInterval;
</span></span><span style="display:flex;"><span>		World<span style="color:#f92672">-&gt;</span>GetTimerManager().SetTimer(TaskMemory<span style="color:#f92672">-&gt;</span>TimerHandle,
</span></span><span style="display:flex;"><span>			FTimerDelegate<span style="color:#f92672">::</span>CreateWeakLambda(<span style="color:#66d9ef">this</span>, [<span style="color:#f92672">&amp;</span>OwnerComp, TaskMemory, <span style="color:#66d9ef">this</span>]() <span style="color:#75715e">// &lt;---- This is the declaration of a weak lambda
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>			{
</span></span><span style="display:flex;"><span>				TaskMemory<span style="color:#f92672">-&gt;</span>TimerHandle.Invalidate();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>				ensure(<span style="color:#f92672">!</span>TaskMemory<span style="color:#f92672">-&gt;</span>bIsAborting);
</span></span><span style="display:flex;"><span>				LogExecution(OwnerComp, LogIndexExecuteFinish);
</span></span><span style="display:flex;"><span>				FinishLatentTask(OwnerComp, LogResult);
</span></span><span style="display:flex;"><span>			}), DeltaTime, false);
</span></span><span style="display:flex;"><span>	}
</span></span></code></pre></div><p>By being aware of these potential dangers and taking appropriate precautions, you can safely use lambdas in Unreal Engine without running into unexpected crashes or undefined behavior.</p>
</section>

  <section id="comments">
    <script src="https://utteranc.es/client.js"
        repo="MrDrElliot/DrElliotBlog"
        issue-term="pathname"
        theme="github-dark"
        crossorigin="anonymous"
        async>
    </script>
</section>
</main>
        <footer id="main-footer"><div class="footer">
  <a href="#">Scroll to Top</a>
  <div class="footer-copyright">
    <div class="dim">© 2025 Dr. Elliot</div>
    <div>Made with ❤️ and powered by <a href="https://github.com/math-queiroz/rusty-typewriter" target="_blank">Rusty Typewriter</a> theme for <a href="https://gohugo.io/" target="_blank">Hugo</a></div>
  </div>
</div>
</footer>
      </div><aside id="side-pane" class="side-sticky"><div class="side-details">
    <span>623 words</span>
    <span>4 - 5 minutes read</span></div><h3>Table Of Contents</h3><nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#1-capturing-by-reference-and-object-lifetimes">1. <strong>Capturing by Reference and Object Lifetimes</strong></a></li>
        <li><a href="#2-deferred-execution">2. <strong>Deferred Execution</strong></a></li>
        <li><a href="#3-complex-debugging">3. <strong>Complex Debugging</strong></a></li>
        <li><a href="#4-capturing-this">4. <strong>Capturing <code>this</code></strong></a></li>
        <li><a href="#how-to-mitigate-these-issues"><strong>How to Mitigate These Issues</strong></a></li>
      </ul>
    </li>
  </ul>
</nav></aside></div>
  </div>
</body>
</html>
