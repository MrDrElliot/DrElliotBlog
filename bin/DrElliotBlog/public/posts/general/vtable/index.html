<!DOCTYPE html>
<html lang="en-us" dir="ltr">
<head>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Fun with V-Tables | Dr. Elliot</title>
<link rel="icon" href="/favicon.svg" sizes="any" type="image/svg+xml" /><meta property="og:url" content="https://www.dr-elliot.com/posts/general/vtable/">
  <meta property="og:site_name" content="Dr. Elliot">
  <meta property="og:title" content="Fun with V-Tables">
  <meta property="og:description" content="Fun with V-Tables! Have you ever wanted to access a function, but you couldn’t because the function is private? :/ Have you wanted to replace a function in a class? Well, look no further! Today we’re going to be talking about V-Table manipulation.
Please note, this is purely for fun and can be dangerous to do in production environments. I don’t recommend using it for actual runtime use, but it can be an interesting exercise in how memory manipulation works and how you can use it to your advantage.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-03-27T12:34:23-05:00">
    <meta property="article:modified_time" content="2025-03-27T12:34:23-05:00">
    <meta property="article:tag" content="Programming">
    <meta property="article:tag" content="CPP">
    <meta property="article:tag" content="C&#43;&#43;">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Fun with V-Tables">
  <meta name="twitter:description" content="Fun with V-Tables! Have you ever wanted to access a function, but you couldn’t because the function is private? :/ Have you wanted to replace a function in a class? Well, look no further! Today we’re going to be talking about V-Table manipulation.
Please note, this is purely for fun and can be dangerous to do in production environments. I don’t recommend using it for actual runtime use, but it can be an interesting exercise in how memory manipulation works and how you can use it to your advantage.">

      <link rel="stylesheet" href="/css/root.min.0e732b812b9751962e01a7c4798a1211cd5f8ac8abec7f99793fe306989e459f.css" integrity="sha256-DnMrgSuXUZYuAafEeYoSEc1fisir7H&#43;ZeT/jBpieRZ8=" crossorigin="anonymous">
      <link rel="stylesheet" href="/css/bundle.min.59eb1a059f8cd558e64375ede3e68d3e9120ddb0c6bdbab555c247689cef59e1.css" integrity="sha256-WesaBZ&#43;M1VjmQ3Xt4&#43;aNPpEg3bDGvbq1VcJHaJzvWeE=" crossorigin="anonymous">

      <script src="/js/bundle.cc8ae9952dbfb731affafabdf26e5c60a6910047ff59ccdeaf1daebaa26c8830.js" integrity="sha256-zIrplS2/tzGv&#43;vq98m5cYKaRAEf/Wczerx2uuqJsiDA=" crossorigin="anonymous"></script><script defer src="/js/search/flexsearch.compact.5e0de3b335e5c523c7cf45473dc43fccb6c75f64a9d59cc04a6eccbb7c25eb49.js" integrity="sha256-Xg3jszXlxSPHz0VHPcQ/zLbHX2Sp1ZzASm7Mu3wl60k="></script>
<script defer src="/js/search/search.1d980f84df11f3eb7c8c5f17f541d49a0611608df179dd74fa7f06225eb56ace.js" integrity="sha256-HZgPhN8R8&#43;t8jF8X9UHUmgYRYI3xed10&#43;n8GIl61as4="></script>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Spectral:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800;1,200;1,300;1,400;1,500;1,600;1,700;1,800&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,200..800&family=Spectral:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800;1,200;1,300;1,400;1,500;1,600;1,700;1,800&display=swap" rel="stylesheet">

</head>
<body class="notransition">
  <div id="container">
    <header id="main-header"><div role="navigation" aria-label="Main">
  <div class="nav-left">
    <a href="https://www.dr-elliot.com/" style="color: inherit;">Dr. Elliot</a>
  </div>
  <div class="nav-right">
    <div style="position:absolute;width:0px;height:0px;">
      <div id="nav-dropdown-menu" class="hidden" href="#">
    <div class="nav-item">
      <a aria-current="true" class="ancestor" href="/posts/"
      >Posts</a>
    </div>
    <div class="nav-item">
      <a href="/lumina/lumina/"
      >Lumina</a>
    </div>
    <div class="nav-item">
      <a href="/about/aboutme/"
      >About</a>
    </div>
</div>
    </div>
    <a id="nav-dropdown-button" href="#"><svg width="20px" height="20px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M4 6H20M4 12H20M4 18H20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
</a>
    <div id="nav-menu">
    <div class="nav-item">
      <a aria-current="true" class="ancestor" href="/posts/"
      >Posts</a>
    </div>
    <div class="nav-item">
      <a href="/lumina/lumina/"
      >Lumina</a>
    </div>
    <div class="nav-item">
      <a href="/about/aboutme/"
      >About</a>
    </div>
</div>
    <a id="theme-switcher" href="#">
<svg class="light-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M12 3V4M12 20V21M4 12H3M6.31412 6.31412L5.5 5.5M17.6859 6.31412L18.5 5.5M6.31412 17.69L5.5 18.5001M17.6859 17.69L18.5 18.5001M21 12H20M16 12C16 14.2091 14.2091 16 12 16C9.79086 16 8 14.2091 8 12C8 9.79086 9.79086 8 12 8C14.2091 8 16 9.79086 16 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
</svg>

<svg class="dark-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M3.32031 11.6835C3.32031 16.6541 7.34975 20.6835 12.3203 20.6835C16.1075 20.6835 19.3483 18.3443 20.6768 15.032C19.6402 15.4486 18.5059 15.6834 17.3203 15.6834C12.3497 15.6834 8.32031 11.654 8.32031 6.68342C8.32031 5.50338 8.55165 4.36259 8.96453 3.32996C5.65605 4.66028 3.32031 7.89912 3.32031 11.6835Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
</a>
  </div>
</div>
</header>
    <div class="flex grow">
      <div id="main-pane">
        <main id="main-content"><div class="single-header">
<ol class="breadcrumbs" itemscope itemtype="https://schema.org/BreadcrumbList">
    <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
      <a itemprop="item" href="https://www.dr-elliot.com/">
        <span itemprop="name">Home</span>
      </a>
      <meta itemprop="position" content='1' />
    </li>
    <span>&nbsp»&nbsp</span>
    <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
      <a itemprop="item" href="https://www.dr-elliot.com/posts/">
        <span itemprop="name">Posts</span>
      </a>
      <meta itemprop="position" content='2' />
    </li>
    <span>&nbsp»&nbsp</span>
</ol>
<h1>Fun with V-Tables</h1><time class="dim" datetime="2025-03-27T12:34:23-05:00">March 27, 2025</time><div class="term-container"><div class="tag">
        <a href="https://www.dr-elliot.com/tags/programming/">#Programming</a>
      </div><div class="tag">
        <a href="https://www.dr-elliot.com/tags/cpp/">#CPP</a>
      </div><div class="tag">
        <a href="https://www.dr-elliot.com/tags/c&#43;&#43;/">#C&#43;&#43;</a>
      </div></ol></div>

  <section class="page-section"><h1 id="fun-with-v-tables">Fun with V-Tables!</h1>
<hr>
<ul>
<li>Have you ever wanted to access a function, but you couldn&rsquo;t because the function is private? :/</li>
<li>Have you wanted to <em>replace</em> a function in a class?</li>
</ul>
<p>Well, look no further! Today we&rsquo;re going to be talking about V-Table manipulation.<br>
Please note, this is purely for fun and can be dangerous to do in production environments. I don&rsquo;t recommend using it for actual runtime use, but it can be an interesting exercise in how memory manipulation works and how you can use it to your advantage.</p>
<hr>
<h2 id="what-is-a-v-table">What is a V-Table?</h2>
<p>A <strong>Virtual Table</strong> (or V-Table) is an essential concept in C++ for implementing <strong>polymorphism</strong>. It’s a data structure used to support dynamic dispatch for virtual functions. When you define a class with virtual functions, the compiler generates a V-Table for that class to keep track of the addresses of those virtual functions. At runtime, the V-Table is used to decide which function to call based on the type of the object, allowing polymorphism to work correctly.</p>
<h3 id="how-does-it-work">How does it work?</h3>
<p>Here’s how a V-Table works:</p>
<ul>
<li>When a class has virtual functions, the compiler creates a special <strong>V-Table</strong> for it.</li>
<li>Each entry in the V-Table points to a corresponding virtual function for that class.</li>
<li>When a virtual function is called on an object, the program uses the V-Table to look up the function pointer, then calls the function based on the correct type.</li>
</ul>
<p>In other words, when you have a base class with a virtual function, the V-Table is what makes sure that the right derived class function gets called at runtime, even if the actual object type is different from the type of the reference or pointer.</p>
<hr>
<h2 id="sniping-the-v-table">Sniping the V-Table</h2>
<p>Now, here’s where the fun begins. What if you wanted to <strong>replace</strong> a function in a class at runtime? Could you do that? With a little bit of memory manipulation, you can! Let&rsquo;s take a look at how we can do this in code:</p>
<p>We’ll modify the V-Table for an object and replace the address of the virtual function with one of our own choosing.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;iostream&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;Windows.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SomeBase</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">virtual</span> <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span><span style="color:#f92672">*</span> VirtualFunction()
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;Hello I&#39;m virtual&#34;</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span><span style="color:#f92672">*</span> <span style="color:#a6e22e">CustomFunction</span>()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;Hello, I&#39;ve been replaced!&#34;</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    SomeBase<span style="color:#f92672">*</span> obj <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> SomeBase(); <span style="color:#75715e">// Allocate on the heap instead of stack
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Access the VTable by treating the object as a pointer to a pointer
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">void</span><span style="color:#f92672">**</span> vtable <span style="color:#f92672">=</span> <span style="color:#f92672">*</span>(<span style="color:#66d9ef">void</span><span style="color:#f92672">***</span>)obj;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Change memory protection to allow write access to the VTable
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    DWORD oldProtect;
</span></span><span style="display:flex;"><span>    VirtualProtect(<span style="color:#f92672">&amp;</span>vtable[<span style="color:#ae81ff">0</span>], <span style="color:#66d9ef">sizeof</span>(<span style="color:#66d9ef">void</span><span style="color:#f92672">*</span>), PAGE_EXECUTE_READWRITE, <span style="color:#f92672">&amp;</span>oldProtect);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Replace the first entry in the VTable with our custom function
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    vtable[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> (<span style="color:#66d9ef">void</span><span style="color:#f92672">*</span>)<span style="color:#f92672">&amp;</span>CustomFunction;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Call the virtual function (it should now call our custom function)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> obj<span style="color:#f92672">-&gt;</span>VirtualFunction() <span style="color:#f92672">&lt;&lt;</span> std<span style="color:#f92672">::</span>endl;  <span style="color:#75715e">// Expected output: &#34;Hello, I&#39;ve been replaced!&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Restore the original memory protection
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    VirtualProtect(<span style="color:#f92672">&amp;</span>vtable[<span style="color:#ae81ff">0</span>], <span style="color:#66d9ef">sizeof</span>(<span style="color:#66d9ef">void</span><span style="color:#f92672">*</span>), oldProtect, <span style="color:#f92672">&amp;</span>oldProtect);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">delete</span> obj; <span style="color:#75715e">// Clean up the heap-allocated object
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="explanation">Explanation:</h3>
<ol>
<li><strong>V-Table Access</strong>: We first access the V-Table for the object by treating the object as a pointer to a pointer (<code>void** vtable = *(void***)obj;</code>).</li>
<li><strong>Memory Protection</strong>: To modify the V-Table, we use <code>VirtualProtect</code> to change the memory protection of the V-Table to <code>PAGE_EXECUTE_READWRITE</code>, allowing us to overwrite the function pointer.</li>
<li><strong>Replacing the Function Pointer</strong>: We replace the first entry in the V-Table (which corresponds to the <code>VirtualFunction</code>) with our own custom function.</li>
<li><strong>Call the Function</strong>: When we call <code>obj-&gt;VirtualFunction()</code>, it calls our custom function instead of the original virtual function.</li>
<li><strong>Restore Protection</strong>: Finally, we restore the original memory protection using <code>VirtualProtect</code> again.</li>
</ol>
<hr>
<h2 id="why-does-this-work">Why Does This Work?</h2>
<p>This works because C++ uses a V-Table to handle dynamic dispatch for virtual functions. By replacing the function pointer in the V-Table, we can redirect calls to our own function. This is a form of &ldquo;sniping&rdquo; the V-Table, where we modify an object&rsquo;s internal function dispatch table to point to a different function.</p>
<hr>
<h2 id="a-word-of-caution">A Word of Caution</h2>
<p>While it’s fun to play around with V-Table manipulation, it&rsquo;s important to note that doing this in real applications can lead to unpredictable behavior, crashes, or memory corruption. This technique can easily break if the compiler or platform changes the way it handles V-Tables, and the object model may vary based on compiler settings, platform, or even optimization flags.</p>
<p>Here are a few things to consider:</p>
<ul>
<li><strong>Stability</strong>: Replacing function pointers in the V-Table can destabilize the program, especially when you&rsquo;re dealing with polymorphic classes or objects with complex inheritance hierarchies.</li>
<li><strong>Compatibility</strong>: This code might break on different compilers or platforms, as not all compilers handle V-Tables the same way.</li>
<li><strong>Safety</strong>: Modifying V-Tables directly can result in <strong>undefined behavior</strong> and is generally discouraged in production code. Use this technique only for educational purposes or in very controlled environments.</li>
</ul>
<hr>
<h2 id="conclusion">Conclusion</h2>
<p>V-Table manipulation is a powerful, albeit dangerous, technique that allows you to modify the behavior of classes at runtime. Whether you want to replace a function for debugging, hacking, or learning purposes, this technique offers an interesting look under the hood of C++&rsquo;s polymorphism.</p>
<p>That being said, <strong>use this power wisely</strong> and remember, there’s a fine line between hacking and hacking yourself into a corner!</p>
<p>Happy coding, and have fun with V-Tables!</p>
</section>

  <section id="comments">
    <script src="https://utteranc.es/client.js"
        repo="MrDrElliot/DrElliotBlog"
        issue-term="pathname"
        theme="github-dark"
        crossorigin="anonymous"
        async>
    </script>
</section>
</main>
        <footer id="main-footer"><div class="footer">
  <a href="#">Scroll to Top</a>
  <div class="footer-copyright">
    <div class="dim">© 2025 Dr. Elliot</div>
    <div>Made with ❤️ and powered by <a href="https://github.com/math-queiroz/rusty-typewriter" target="_blank">Rusty Typewriter</a> theme for <a href="https://gohugo.io/" target="_blank">Hugo</a></div>
  </div>
</div>
</footer>
      </div><aside id="side-pane" class="side-sticky"><div class="side-details">
    <span>862 words</span>
    <span>5 - 6 minutes read</span></div><h3>Table Of Contents</h3><nav id="TableOfContents">
  <ul>
    <li><a href="#what-is-a-v-table">What is a V-Table?</a>
      <ul>
        <li><a href="#how-does-it-work">How does it work?</a></li>
      </ul>
    </li>
    <li><a href="#sniping-the-v-table">Sniping the V-Table</a>
      <ul>
        <li><a href="#explanation">Explanation:</a></li>
      </ul>
    </li>
    <li><a href="#why-does-this-work">Why Does This Work?</a></li>
    <li><a href="#a-word-of-caution">A Word of Caution</a></li>
    <li><a href="#conclusion">Conclusion</a></li>
  </ul>
</nav><h3>Related</h3>
    <ul><li><a href="/posts/memory/movesemantics/">Move Semantics</a></li><li><a href="/posts/memory/softreferences/">What Are Soft References?</a></li><li><a href="/posts/general/constexpr/">Constexpr and Consteval</a></li><li><a href="/posts/memory/buffers/">Working With Buffers</a></li><li><a href="/posts/general/lambdadangers/">The dangers of Lambdas</a></li></ul></aside></div>
  </div>
</body>
</html>
