<!DOCTYPE html>
<html lang="en-us" dir="ltr">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Move Semantics | Dr. Elliot</title>
<link rel="icon" href="/favicon.svg" sizes="any" type="image/svg+xml" /><meta property="og:url" content="http://localhost:1313/archive/movesemantics/">
  <meta property="og:site_name" content="Dr. Elliot">
  <meta property="og:title" content="Move Semantics">
  <meta property="og:description" content="Hello! Today, I want to talk about a commonly misunderstood concept in programming: Move Semantics.
Move semantics involve efficiently transferring ownership of resources (like memory) from one object to another, instead of copying the data, which adds unnecessary overhead. This is especially important in performance-critical applications such as game development, where proper memory management can make a big difference in efficiency. Games, just like any other software, are prone to performance pitfalls caused by poor handling of move semantics.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="archive">
    <meta property="article:published_time" content="2024-09-29T12:28:45-05:00">
    <meta property="article:modified_time" content="2024-09-29T12:28:45-05:00">
    <meta property="article:tag" content="CPP">
    <meta property="article:tag" content="C&#43;&#43;">
    <meta property="article:tag" content="Optimization">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Move Semantics">
  <meta name="twitter:description" content="Hello! Today, I want to talk about a commonly misunderstood concept in programming: Move Semantics.
Move semantics involve efficiently transferring ownership of resources (like memory) from one object to another, instead of copying the data, which adds unnecessary overhead. This is especially important in performance-critical applications such as game development, where proper memory management can make a big difference in efficiency. Games, just like any other software, are prone to performance pitfalls caused by poor handling of move semantics.">

    <link rel="stylesheet" href="/css/root.css">
    <link rel="stylesheet" href="/css/bundle.css">

      <script src="/js/bundle.js"></script><script defer src="/js/search/flexsearch.compact.5e0de3b335e5c523c7cf45473dc43fccb6c75f64a9d59cc04a6eccbb7c25eb49.js" integrity="sha256-Xg3jszXlxSPHz0VHPcQ/zLbHX2Sp1ZzASm7Mu3wl60k="></script>
<script defer src="/js/search/search.1d980f84df11f3eb7c8c5f17f541d49a0611608df179dd74fa7f06225eb56ace.js" integrity="sha256-HZgPhN8R8&#43;t8jF8X9UHUmgYRYI3xed10&#43;n8GIl61as4="></script>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Spectral:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800;1,200;1,300;1,400;1,500;1,600;1,700;1,800&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,200..800&family=Spectral:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800;1,200;1,300;1,400;1,500;1,600;1,700;1,800&display=swap" rel="stylesheet">

</head>
<body class="notransition">
  <div id="container">
    <header id="main-header"><div role="navigation" aria-label="Main">
  <div class="nav-left">
    <a href="http://localhost:1313/" style="color: inherit;">Dr. Elliot</a>
  </div>
  <div class="nav-right">
    <div style="position:absolute;width:0px;height:0px;">
      <div id="nav-dropdown-menu" class="hidden" href="#">
    <div class="nav-item">
      <a href="/posts/"
      >Posts</a>
    </div>
    <div class="nav-item">
      <a href="/lumina/lumina/"
      >Lumina</a>
    </div>
    <div class="nav-item">
      <a href="/about/aboutme/"
      >About</a>
    </div>
</div>
    </div>
    <a id="nav-dropdown-button" href="#"><svg width="20px" height="20px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M4 6H20M4 12H20M4 18H20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
</a>
    <div id="nav-menu">
    <div class="nav-item">
      <a href="/posts/"
      >Posts</a>
    </div>
    <div class="nav-item">
      <a href="/lumina/lumina/"
      >Lumina</a>
    </div>
    <div class="nav-item">
      <a href="/about/aboutme/"
      >About</a>
    </div>
</div>
    <a id="theme-switcher" href="#">
<svg class="light-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M12 3V4M12 20V21M4 12H3M6.31412 6.31412L5.5 5.5M17.6859 6.31412L18.5 5.5M6.31412 17.69L5.5 18.5001M17.6859 17.69L18.5 18.5001M21 12H20M16 12C16 14.2091 14.2091 16 12 16C9.79086 16 8 14.2091 8 12C8 9.79086 9.79086 8 12 8C14.2091 8 16 9.79086 16 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
</svg>

<svg class="dark-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M3.32031 11.6835C3.32031 16.6541 7.34975 20.6835 12.3203 20.6835C16.1075 20.6835 19.3483 18.3443 20.6768 15.032C19.6402 15.4486 18.5059 15.6834 17.3203 15.6834C12.3497 15.6834 8.32031 11.654 8.32031 6.68342C8.32031 5.50338 8.55165 4.36259 8.96453 3.32996C5.65605 4.66028 3.32031 7.89912 3.32031 11.6835Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
</a>
  </div>
</div>
</header>
    <div class="flex grow">
      <div id="main-pane">
        <main id="main-content"><div class="single-header">
<ol class="breadcrumbs" itemscope itemtype="https://schema.org/BreadcrumbList">
    <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
      <a itemprop="item" href="http://localhost:1313/">
        <span itemprop="name">Home</span>
      </a>
      <meta itemprop="position" content='1' />
    </li>
    <span>&nbsp»&nbsp</span>
    <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
      <a itemprop="item" href="http://localhost:1313/archive/">
        <span itemprop="name">Archives</span>
      </a>
      <meta itemprop="position" content='2' />
    </li>
    <span>&nbsp»&nbsp</span>
</ol>
<h1>Move Semantics</h1><time class="dim" datetime="2024-09-29T12:28:45-05:00">September 29, 2024</time><div class="term-container"><div class="tag">
        <a href="http://localhost:1313/tags/cpp/">#CPP</a>
      </div><div class="tag">
        <a href="http://localhost:1313/tags/c&#43;&#43;/">#C&#43;&#43;</a>
      </div><div class="tag">
        <a href="http://localhost:1313/tags/optimization/">#Optimization</a>
      </div></ol></div>

  <section class="page-section"><p>Hello! Today, I want to talk about a commonly misunderstood concept in programming: <strong>Move Semantics</strong>.</p>
<p>Move semantics involve efficiently transferring ownership of resources (like memory) from one object to another, instead of copying the data, which adds unnecessary overhead. This is especially important in performance-critical applications such as <strong>game development</strong>, where proper memory management can make a big difference in efficiency. Games, just like any other software, are prone to performance pitfalls caused by poor handling of move semantics. By the end of this post, you should have a better grasp of how to avoid these inefficiencies.</p>
<p>We’ll cover the basics of <strong>lvalue</strong> and <strong>rvalue</strong>, explore move semantics in C++ and Unreal Engine, and show real-world examples in both <strong>raw C++</strong> and <strong>Unreal Engine’s C++</strong>.</p>
<p>Let’s get started!</p>
<h2 id="understanding-the-problem">Understanding the Problem</h2>
<p>Let’s first consider a raw C++ example:</p>
<h3 id="raw-c-code-example">Raw C++ Code Example:</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;iostream&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;vector&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> gAllocations <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> gCopies <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span><span style="color:#f92672">*</span> <span style="color:#66d9ef">operator</span> <span style="color:#a6e22e">new</span>(size_t size)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    gAllocations<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> malloc(size);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Data</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> integer <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>    Data() <span style="color:#f92672">=</span> <span style="color:#66d9ef">default</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    Data(<span style="color:#66d9ef">int</span> i) <span style="color:#f92672">:</span> integer(i) {}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    Data(<span style="color:#66d9ef">const</span> Data<span style="color:#f92672">&amp;</span> Other)
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">:</span> integer(Other.integer)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        gCopies<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>        std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Copied Data</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">PrintVector</span>(std<span style="color:#f92672">::</span>vector<span style="color:#f92672">&lt;</span>Data<span style="color:#f92672">&gt;</span> InData)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Size: &#34;</span> <span style="color:#f92672">&lt;&lt;</span> InData.size() <span style="color:#f92672">&lt;&lt;</span> std<span style="color:#f92672">::</span>endl;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (InData.empty())
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Elements: { &#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> InData.size(); i<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> InData[i].integer;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (i <span style="color:#f92672">&lt;</span> InData.size() <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;, &#34;</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34; }</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>vector<span style="color:#f92672">&lt;</span>Data<span style="color:#f92672">&gt;</span> Numbers;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (size_t i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">5</span>; i<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        Numbers.push_back(Data(i));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    PrintVector(Numbers);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Allocation: &#34;</span> <span style="color:#f92672">&lt;&lt;</span> gAllocations <span style="color:#f92672">&lt;&lt;</span> std<span style="color:#f92672">::</span>endl;
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Copies: &#34;</span> <span style="color:#f92672">&lt;&lt;</span> gCopies;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>cin.get();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="the-output">The Output:</h3>
<pre tabindex="0"><code>Copied Data
Copied Data
Copied Data
...
Size: 5
Elements: { 0, 1, 2, 3, 4 }
Allocation: 8
Copies: 20
</code></pre><p>Here, we have <strong>8 allocations</strong> and <strong>20 copies</strong> of <code>Data</code>. This is far from optimal and can be a performance bottleneck, especially when dealing with large datasets.</p>
<h4 id="why-are-there-so-many-copies">Why Are There So Many Copies?</h4>
<ol>
<li>
<p><strong>Passing the Vector by Value</strong>:<br>
The function <code>PrintVector</code> takes the <code>std::vector&lt;Data&gt;</code> by value, meaning that the vector and all its elements are copied when passed. Each copy of a <code>Data</code> object triggers the copy constructor, which adds unnecessary overhead.</p>
</li>
<li>
<p><strong>Multiple Allocations</strong>:<br>
As <code>push_back</code> is called, the vector resizes its internal storage, leading to multiple reallocations. Each reallocation can result in copying existing elements into new memory blocks, further adding to the overhead.</p>
</li>
</ol>
<h2 id="fixing-the-code-with-move-semantics">Fixing the Code with Move Semantics</h2>
<p>We can improve the performance by using <strong>move semantics</strong>. Let’s look at an optimized C++ version and then explore how Unreal Engine’s <code>TArray</code> can provide similar behavior.</p>
<h3 id="optimized-raw-c-code">Optimized Raw C++ Code:</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;iostream&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;vector&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> gAllocations <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> gCopies <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> gMoves <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span><span style="color:#f92672">*</span> <span style="color:#66d9ef">operator</span> <span style="color:#a6e22e">new</span>(size_t size)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Allocated: &#34;</span> <span style="color:#f92672">&lt;&lt;</span> size <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34; bytes</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>    gAllocations<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> malloc(size);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Data</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> integer <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    Data() <span style="color:#f92672">=</span> <span style="color:#66d9ef">default</span>;
</span></span><span style="display:flex;"><span>    Data(<span style="color:#66d9ef">int</span> i) <span style="color:#f92672">:</span> integer(i) {}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    Data(<span style="color:#66d9ef">const</span> Data<span style="color:#f92672">&amp;</span> Other)
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">:</span> integer(Other.integer)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        gCopies<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>        std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Copied Data</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    Data(Data<span style="color:#f92672">&amp;&amp;</span> Other) <span style="color:#66d9ef">noexcept</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">:</span> integer(Other.integer)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        gMoves<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>        std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Moved Data</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>        Other.integer <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;  <span style="color:#75715e">// Optional: Invalidate the source object
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    }
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">PrintVector</span>(<span style="color:#66d9ef">const</span> std<span style="color:#f92672">::</span>vector<span style="color:#f92672">&lt;</span>Data<span style="color:#f92672">&gt;&amp;</span> InData)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Size: &#34;</span> <span style="color:#f92672">&lt;&lt;</span> InData.size() <span style="color:#f92672">&lt;&lt;</span> std<span style="color:#f92672">::</span>endl;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (InData.empty())
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Elements: { &#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> InData.size(); i<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> InData[i].integer;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (i <span style="color:#f92672">&lt;</span> InData.size() <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;, &#34;</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34; }</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>vector<span style="color:#f92672">&lt;</span>Data<span style="color:#f92672">&gt;</span> Numbers;
</span></span><span style="display:flex;"><span>    Numbers.reserve(<span style="color:#ae81ff">5</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (size_t i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">5</span>; i<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        Numbers.emplace_back(i);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    PrintVector(Numbers);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Allocations: &#34;</span> <span style="color:#f92672">&lt;&lt;</span> gAllocations <span style="color:#f92672">&lt;&lt;</span> std<span style="color:#f92672">::</span>endl;
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Copies: &#34;</span> <span style="color:#f92672">&lt;&lt;</span> gCopies <span style="color:#f92672">&lt;&lt;</span> std<span style="color:#f92672">::</span>endl;
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Moves: &#34;</span> <span style="color:#f92672">&lt;&lt;</span> gMoves <span style="color:#f92672">&lt;&lt;</span> std<span style="color:#f92672">::</span>endl;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>cin.get();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="the-new-output">The New Output:</h3>
<pre tabindex="0"><code>Allocated: 16 bytes
Allocated: 20 bytes
Size: 5
Elements: { 0, 1, 2, 3, 4 }
Allocations: 2
Copies: 0
Moves: 0
</code></pre><h3 id="what-changed">What Changed?</h3>
<ol>
<li>
<p><strong>Passing by Const Reference</strong>:<br>
Passing the vector by <code>const std::vector&lt;Data&gt;&amp;</code> avoids copying the entire vector and its elements when calling <code>PrintVector</code>.</p>
</li>
<li>
<p><strong>Using <code>reserve()</code></strong>:<br>
Pre-allocating memory with <code>reserve(5)</code> prevents reallocations as we insert elements, reducing the number of allocations to two.</p>
</li>
<li>
<p><strong>Using <code>emplace_back()</code></strong>:<br>
This avoids creating temporary objects and thus reduces unnecessary copying or moving.</p>
</li>
</ol>
<hr>
<p>Just to put this in there, you don&rsquo;t always need to use a vector if you know the size. A std::array makes more sense in situations where you know the size.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">PrintVector</span>(<span style="color:#66d9ef">const</span> std<span style="color:#f92672">::</span>array<span style="color:#f92672">&lt;</span>Data, <span style="color:#ae81ff">5</span><span style="color:#f92672">&gt;&amp;</span> InData)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Size: &#34;</span> <span style="color:#f92672">&lt;&lt;</span> InData.size() <span style="color:#f92672">&lt;&lt;</span> std<span style="color:#f92672">::</span>endl;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (InData.empty())
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Elements: { &#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> InData.size(); i<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> InData[i].integer;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (i <span style="color:#f92672">&lt;</span> InData.size() <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;, &#34;</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34; }</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>array<span style="color:#f92672">&lt;</span>Data, <span style="color:#ae81ff">5</span><span style="color:#f92672">&gt;</span> Numbers;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (size_t i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">5</span>; i<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        Numbers[i].integer <span style="color:#f92672">=</span> i;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    PrintVector(Numbers);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Allocation: &#34;</span> <span style="color:#f92672">&lt;&lt;</span> gAllocations <span style="color:#f92672">&lt;&lt;</span> std<span style="color:#f92672">::</span>endl;
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Copies: &#34;</span> <span style="color:#f92672">&lt;&lt;</span> gCopies <span style="color:#f92672">&lt;&lt;</span> std<span style="color:#f92672">::</span>endl;
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Moves: &#34;</span> <span style="color:#f92672">&lt;&lt;</span> gMoves;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>cin.get();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>This my by far the most efficient.</p>
<pre tabindex="0"><code>Size: 5
Elements: { 0, 1, 2, 3, 4 }
Allocation: 0
Copies: 0
Moves: 0
</code></pre><p>But we&rsquo;re more talking about vectors and dynamic memory allocation, which is why we use .reserve() to allocate the memory once where we need it.</p>
<h2 id="move-semantics-in-unreal-engine">Move Semantics in Unreal Engine</h2>
<p>Unreal Engine’s <code>TArray</code> is the engine&rsquo;s equivalent to <code>std::vector</code> in C++. Much like in raw C++, you can benefit from move semantics when working with <code>TArray</code> to avoid unnecessary copies and allocations.</p>
<h3 id="unreal-engine-example">Unreal Engine Example:</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&#34;CoreMinimal.h&#34;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>int32 gAllocations <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>int32 gCopies <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>int32 gMoves <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span><span style="color:#f92672">*</span> <span style="color:#66d9ef">operator</span> <span style="color:#a6e22e">new</span>(size_t size)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    gAllocations<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> FMemory<span style="color:#f92672">::</span>Malloc(size);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">FData</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    int32 Integer <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    FData() <span style="color:#f92672">=</span> <span style="color:#66d9ef">default</span>;
</span></span><span style="display:flex;"><span>    FData(int32 i) <span style="color:#f92672">:</span> Integer(i) {}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    FData(<span style="color:#66d9ef">const</span> FData<span style="color:#f92672">&amp;</span> Other)
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">:</span> Integer(Other.Integer)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        gCopies<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>        UE_LOG(LogTemp, Warning, TEXT(<span style="color:#e6db74">&#34;Copied Data&#34;</span>));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    FData(FData<span style="color:#f92672">&amp;&amp;</span> Other) <span style="color:#66d9ef">noexcept</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">:</span> Integer(Other.Integer)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        gMoves<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>        UE_LOG(LogTemp, Warning, TEXT(<span style="color:#e6db74">&#34;Moved Data&#34;</span>));
</span></span><span style="display:flex;"><span>        Other.Integer <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;  <span style="color:#75715e">// Optional: Invalidate the source object
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    }
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">PrintTArray</span>(<span style="color:#66d9ef">const</span> TArray<span style="color:#f92672">&lt;</span>FData<span style="color:#f92672">&gt;&amp;</span> InData)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    UE_LOG(LogTemp, Warning, TEXT(<span style="color:#e6db74">&#34;Size: %d&#34;</span>), InData.Num());
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (InData.Num() <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    FString Elements <span style="color:#f92672">=</span> TEXT(<span style="color:#e6db74">&#34;Elements: { &#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (int32 i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> InData.Num(); i<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        Elements <span style="color:#f92672">+=</span> FString<span style="color:#f92672">::</span>FromInt(InData[i].Integer);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (i <span style="color:#f92672">&lt;</span> InData.Num() <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            Elements <span style="color:#f92672">+=</span> TEXT(<span style="color:#e6db74">&#34;, &#34;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    Elements <span style="color:#f92672">+=</span> TEXT(<span style="color:#e6db74">&#34; }&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    UE_LOG(LogTemp, Warning, TEXT(<span style="color:#e6db74">&#34;%s&#34;</span>), <span style="color:#f92672">*</span>Elements);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">TestMoveSemantics</span>()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    TArray<span style="color:#f92672">&lt;</span>FData<span style="color:#f92672">&gt;</span> Numbers;
</span></span><span style="display:flex;"><span>    Numbers.Reserve(<span style="color:#ae81ff">5</span>);  <span style="color:#75715e">// Pre-allocate memory to prevent reallocations
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (int32 i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">5</span>; i<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        Numbers.Emplace(i);  <span style="color:#75715e">// Emplace to avoid copies
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    PrintTArray(Numbers);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    UE_LOG(LogTemp, Warning, TEXT(<span style="color:#e6db74">&#34;Allocations: %d&#34;</span>), gAllocations);
</span></span><span style="display:flex;"><span>    UE_LOG(LogTemp, Warning, TEXT(<span style="color:#e6db74">&#34;Copies: %d&#34;</span>), gCopies);
</span></span><span style="display:flex;"><span>    UE_LOG(LogTemp, Warning, TEXT(<span style="color:#e6db74">&#34;Moves: %d&#34;</span>), gMoves);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Bringing back up that std::array over std::vector point, you can use TArray allocators to solve the need to create that second allocation <strong>(Numbers.Reserve(5))</strong>. You could just inline the array allocation if you know it&rsquo;s only a specific size.</p>
<p>Here&rsquo;s an example:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>    TArray<span style="color:#f92672">&lt;</span>FData, TInlineAllocator<span style="color:#f92672">&lt;</span><span style="color:#ae81ff">5</span><span style="color:#f92672">&gt;&gt;</span> Numbers;
</span></span><span style="display:flex;"><span>    TArray<span style="color:#f92672">&lt;</span>FData, TFixedAllocator<span style="color:#f92672">&lt;</span><span style="color:#ae81ff">5</span><span style="color:#f92672">&gt;&gt;</span> Numbers;
</span></span><span style="display:flex;"><span>    ...
</span></span></code></pre></div><h3 id="the-unreal-engine-output">The Unreal Engine Output:</h3>
<pre tabindex="0"><code>Copied Data
Copied Data
...
Size: 5
Elements: { 0, 1, 2, 3, 4 }
Allocations: 2
Copies: 0
Moves: 0
</code></pre><hr>
<h2 id="conclusion">Conclusion</h2>
<p>By understanding and properly applying <strong>move semantics</strong>, you can drastically reduce unnecessary allocations and copies in your programs, leading to better performance. This is especially important in performance-critical applications like game development, whether you&rsquo;re using raw C++ or Unreal Engine’s <code>TArray</code>.</p>
<p>In our examples, both in C++ and Unreal Engine, we reduced the number of allocations and eliminated unnecessary copies by:</p>
<ol>
<li>Passing containers by const reference.</li>
<li>Pre-allocating memory to prevent reallocations.</li>
<li>Using <code>emplace_back()</code> in C++ or <code>Emplace()</code> in Unreal Engine.</li>
</ol>
<p>Mastering these techniques will help you write more efficient code in any game development environment!</p>
<p>Thanks for reading! Hopefully, you now have a better understanding of move semantics and how to apply them in both raw C++ and Unreal Engine.</p>
</section>

  <section id="comments">
    <script src="https://utteranc.es/client.js"
        repo="MrDrElliot/DrElliotBlog"
        issue-term="pathname"
        theme="github-dark"
        crossorigin="anonymous"
        async>
    </script>
</section>
</main>
        <footer id="main-footer"><div class="footer">
  <a href="#">Scroll to Top</a>
  <div class="footer-copyright">
    <div class="dim">© 2025 Dr. Elliot</div>
    <div>Made with ❤️ and powered by <a href="https://github.com/math-queiroz/rusty-typewriter" target="_blank">Rusty Typewriter</a> theme for <a href="https://gohugo.io/" target="_blank">Hugo</a></div>
  </div>
</div>
</footer>
      </div><aside id="side-pane" class="side-sticky"><div class="side-details">
    <span>1295 words</span>
    <span>8 - 11 minutes read</span></div><h3>Table Of Contents</h3><nav id="TableOfContents">
  <ul>
    <li><a href="#understanding-the-problem">Understanding the Problem</a>
      <ul>
        <li><a href="#raw-c-code-example">Raw C++ Code Example:</a></li>
        <li><a href="#the-output">The Output:</a></li>
      </ul>
    </li>
    <li><a href="#fixing-the-code-with-move-semantics">Fixing the Code with Move Semantics</a>
      <ul>
        <li><a href="#optimized-raw-c-code">Optimized Raw C++ Code:</a></li>
        <li><a href="#the-new-output">The New Output:</a></li>
        <li><a href="#what-changed">What Changed?</a></li>
      </ul>
    </li>
    <li><a href="#move-semantics-in-unreal-engine">Move Semantics in Unreal Engine</a>
      <ul>
        <li><a href="#unreal-engine-example">Unreal Engine Example:</a></li>
        <li><a href="#the-unreal-engine-output">The Unreal Engine Output:</a></li>
      </ul>
    </li>
    <li><a href="#conclusion">Conclusion</a></li>
  </ul>
</nav><h3>Related</h3>
    <ul><li><a href="/posts/memory/softreferences/">What Are Soft References?</a></li><li><a href="/posts/general/constexpr/">Constexpr and Consteval</a></li><li><a href="/posts/memory/buffers/">Working With Buffers</a></li><li><a href="/posts/optimization/thecastscare/">The Cast Scare</a></li></ul></aside></div>
  </div>
</body>
</html>
